# è¨ˆç®—æ©Ÿ UX å¢å¼·åŠŸèƒ½ BDD æ¸¬è©¦è¦æ ¼

**ç‰ˆæœ¬**: 1.1.0 (CRITICAL FIX)  
**å»ºç«‹æ™‚é–“**: 2025-11-19T23:18:00+08:00  
**æ›´æ–°æ™‚é–“**: 2025-11-19T23:36:54+08:00  
**ç‹€æ…‹**: âœ… å·²å®Œæˆï¼ˆå«ç·Šæ€¥ä¿®å¾©ï¼‰  
**åƒè€ƒ**: Web Research 2025-11-19, Apple HIG, iOS Calculator, Bug Report 2025-11-19

---

## ç›®æ¨™

å„ªåŒ–è¨ˆç®—æ©Ÿ UX é«”é©—ï¼Œæå‡å¯è®€æ€§èˆ‡è¦–è¦ºåé¥‹ï¼Œåƒè€ƒ iOS Calculator æ¨™æº–ä½†è¶…è¶Šå…¶é«”é©—ã€‚

---

## BDD å ´æ™¯è¦æ ¼

### å ´æ™¯ 1ï¼šç®—å¼é¡¯ç¤ºå€åƒä½åˆ†éš”ç¬¦æ ¼å¼åŒ–

```gherkin
åŠŸèƒ½: ç®—å¼é¡¯ç¤ºå€æ•¸å­—æ ¼å¼åŒ–
  ç‚ºäº†æå‡æ•¸å­—å¯è®€æ€§
  ä½œç‚ºç”¨æˆ¶
  æˆ‘å¸Œæœ›çœ‹åˆ°åƒä½åˆ†éš”ç¬¦æ ¼å¼åŒ–çš„ç®—å¼

å ´æ™¯: è¼¸å…¥å¤§æ•¸å­—ç®—å¼æ™‚é¡¯ç¤ºåƒä½åˆ†éš”ç¬¦
  å‡è¨­ ç”¨æˆ¶æ‰“é–‹è¨ˆç®—æ©Ÿ
  ç•¶ ç”¨æˆ¶è¼¸å…¥ "1234 + 5678"
  é‚£éº¼ ç®—å¼é¡¯ç¤ºå€æ‡‰é¡¯ç¤º "1,234 + 5,678"
  ä¸¦ä¸” é è¦½çµæœæ‡‰é¡¯ç¤º "6,912"

å ´æ™¯: å‰å°é›¶æ‡‰è¢«ç§»é™¤
  å‡è¨­ ç”¨æˆ¶æ‰“é–‹è¨ˆç®—æ©Ÿ
  ç•¶ ç”¨æˆ¶è¼¸å…¥ "012 + 034"
  é‚£éº¼ ç®—å¼é¡¯ç¤ºå€æ‡‰é¡¯ç¤º "12 + 34"
  ä¸¦ä¸” é è¦½çµæœæ‡‰é¡¯ç¤º "46"
```

**å¯¦ä½œæª”æ¡ˆ**:

- `apps/ratewise/src/features/calculator/components/ExpressionDisplay.tsx`
- `apps/ratewise/src/features/calculator/utils/formatCalculatorNumber.ts`

**æ¸¬è©¦æª”æ¡ˆ**:

- `apps/ratewise/src/features/calculator/components/__tests__/ExpressionDisplay.test.tsx`

---

### å ´æ™¯ 2ï¼šæŒ‰éˆ•é»æ“Šè¦–è¦ºåé¥‹å‹•ç•«

```gherkin
åŠŸèƒ½: æŒ‰éˆ•é»æ“Šå‹•ç•«åé¥‹
  ç‚ºäº†æä¾›æ›´æ¸…æ™°çš„äº’å‹•åé¥‹
  ä½œç‚ºç”¨æˆ¶
  æˆ‘å¸Œæœ›é»æ“ŠæŒ‰éˆ•æ™‚çœ‹åˆ°æ˜é¡¯çš„æ”¾å¤§æ•ˆæœ

å ´æ™¯: é»æ“Šæ•¸å­—æŒ‰éˆ•æ™‚æ”¾å¤§
  å‡è¨­ ç”¨æˆ¶æ‰“é–‹è¨ˆç®—æ©Ÿ
  ç•¶ ç”¨æˆ¶é»æ“Šæ•¸å­—æŒ‰éˆ• "5"
  é‚£éº¼ æŒ‰éˆ•æ‡‰æ”¾å¤§åˆ° 110%
  ä¸¦ä¸” å‹•ç•«æ‡‰åœ¨ 100ms å…§å®Œæˆ
  ä¸¦ä¸” ä½¿ç”¨ spring å‹•ç•«ï¼ˆstiffness: 500, damping: 30ï¼‰

å ´æ™¯: æ‡¸åœæ™‚è¼•å¾®æ”¾å¤§
  å‡è¨­ ç”¨æˆ¶æ‰“é–‹è¨ˆç®—æ©Ÿ
  ç•¶ ç”¨æˆ¶æ‡¸åœåœ¨æŒ‰éˆ•ä¸Š
  é‚£éº¼ æŒ‰éˆ•æ‡‰è¼•å¾®æ”¾å¤§åˆ° 102%
  ä¸¦ä¸” é¿å…éåº¦å‹•ç•«å¹²æ“¾
```

**å¯¦ä½œæª”æ¡ˆ**:

- `apps/ratewise/src/features/calculator/components/CalculatorKey.tsx`

**è®Šæ›´å…§å®¹**:

```typescript
// å‰ï¼šwhileTap={{ scale: 0.95 }}
// å¾Œï¼šwhileTap={{ scale: 1.1 }}

// å‰ï¼šwhileHover={{ scale: 1.05 }}
// å¾Œï¼šwhileHover={{ scale: 1.02 }}

// å‰ï¼šstiffness: 400, damping: 25
// å¾Œï¼šstiffness: 500, damping: 30
```

---

### å ´æ™¯ 3ï¼šé•·æŒ‰åˆªé™¤ iOS æ¨™æº–å°é½Š

```gherkin
åŠŸèƒ½: é•·æŒ‰åˆªé™¤è¡Œç‚º
  ç‚ºäº†å°é½Š iOS Calculator æ¨™æº–
  ä½œç‚ºç”¨æˆ¶
  æˆ‘å¸Œæœ›é•·æŒ‰ Backspace æ™‚ä»¥å›ºå®šé–“éš”é€£çºŒåˆªé™¤

å ´æ™¯: å–®æ“Š Backspace ç«‹å³åˆªé™¤
  å‡è¨­ ç”¨æˆ¶è¼¸å…¥ "12345"
  ç•¶ ç”¨æˆ¶å–®æ“Š Backspace æŒ‰éˆ•
  é‚£éº¼ æ‡‰ç«‹å³åˆªé™¤æœ€å¾Œä¸€å€‹å­—å…ƒ
  ä¸¦ä¸” é¡¯ç¤º "1234"

å ´æ™¯: é•·æŒ‰ Backspace é€£çºŒåˆªé™¤
  å‡è¨­ ç”¨æˆ¶è¼¸å…¥ "123456789"
  ç•¶ ç”¨æˆ¶é•·æŒ‰ Backspace æŒ‰éˆ•è¶…é 500ms
  é‚£éº¼ æ‡‰é–‹å§‹é€£çºŒåˆªé™¤
  ä¸¦ä¸” æ¯ 100ms åˆªé™¤ä¸€å€‹å­—å…ƒ
  ä¸¦ä¸” æ¯æ¬¡åˆªé™¤éƒ½æœ‰è§¸è¦ºåé¥‹

å ´æ™¯: é‡‹æ”¾æŒ‰éˆ•åœæ­¢åˆªé™¤
  å‡è¨­ ç”¨æˆ¶æ­£åœ¨é•·æŒ‰ Backspace
  ç•¶ ç”¨æˆ¶é‡‹æ”¾æŒ‰éˆ•
  é‚£éº¼ åˆªé™¤å‹•ä½œæ‡‰ç«‹å³åœæ­¢
```

**å¯¦ä½œæª”æ¡ˆ**:

- `apps/ratewise/src/features/calculator/hooks/useLongPress.ts`
- `apps/ratewise/src/features/calculator/components/CalculatorKey.tsx`

**è®Šæ›´å…§å®¹**:

```typescript
// useLongPress.ts
// å‰ï¼šthreshold: 400, åŠ é€Ÿé‚è¼¯ï¼ˆ80ms â†’ 40ms â†’ 20ms â†’ 10msï¼‰
// å¾Œï¼šthreshold: 500, interval: 100ï¼ˆå›ºå®šé–“éš”ï¼‰

// CalculatorKey.tsx
// å‰ï¼šthreshold: 400 // iOS æ¥µé€Ÿåˆå§‹å»¶é²
// å¾Œï¼šthreshold: 500 // iOS æ¨™æº–åˆå§‹å»¶é²
```

---

## é©—è­‰çµæœ

### 1. é¡å‹æª¢æŸ¥

```bash
pnpm typecheck
# âœ… é€šéï¼ˆé›¶éŒ¯èª¤ï¼‰
```

### 2. æ¸¬è©¦è¦†è“‹

```bash
pnpm test
# âœ… 357/357 æ¸¬è©¦é€šé
```

### 3. äººå·¥é©—è­‰æª¢æŸ¥æ¸…å–®

- [ ] ç®—å¼é¡¯ç¤ºå€æ•¸å­—é¡¯ç¤ºåƒä½åˆ†éš”ç¬¦
- [ ] å‰å°é›¶è¢«æ­£ç¢ºç§»é™¤ï¼ˆ012 â†’ 12ï¼‰
- [ ] æŒ‰éˆ•é»æ“Šæ™‚æ”¾å¤§å‹•ç•«æ˜é¡¯å¯è¦‹
- [ ] æ‡¸åœå‹•ç•«ä¸æœƒéåº¦å¹²æ“¾
- [ ] å–®æ“Š Backspace ç«‹å³éŸ¿æ‡‰
- [ ] é•·æŒ‰ Backspace 500ms å¾Œé–‹å§‹é€£çºŒåˆªé™¤
- [ ] é•·æŒ‰æ™‚æ¯ 100ms åˆªé™¤ä¸€å€‹å­—å…ƒ
- [ ] é‡‹æ”¾æŒ‰éˆ•ç«‹å³åœæ­¢åˆªé™¤
- [ ] è§¸è¦ºåé¥‹æ­£å¸¸ï¼ˆæ”¯æ´çš„è£ç½®ï¼‰

---

## Linus ä¸‰å•é©—è­‰

### 1. "é€™æ˜¯å€‹çœŸå•é¡Œé‚„æ˜¯è‡†æƒ³å‡ºä¾†çš„ï¼Ÿ"

âœ… **çœŸå•é¡Œ**

- ç”¨æˆ¶åé¥‹ï¼šç®—å¼å€æ•¸å­—ä¸æ˜“é–±è®€
- æŒ‰éˆ•å‹•ç•«åé¥‹ä¸å¤ æ˜é¡¯
- é•·æŒ‰åˆªé™¤éœ€å°é½Š iOS æ¨™æº–

### 2. "æœ‰æ›´ç°¡å–®çš„æ–¹æ³•å—ï¼Ÿ"

âœ… **å·²æ¡ç”¨æœ€ç°¡æ–¹æ¡ˆ**

- é‡ç”¨ç¾æœ‰ `formatExpression` å·¥å…·
- èª¿æ•´ Motion å‹•ç•«åƒæ•¸ï¼ˆé›¶ä¾è³´ï¼‰
- ç°¡åŒ– `useLongPress` åŠ é€Ÿé‚è¼¯ï¼ˆç§»é™¤è¤‡é›œåˆ†æ”¯ï¼‰

### 3. "æœƒç ´å£ä»€éº¼å—ï¼Ÿ"

âœ… **é›¶ç ´å£æ€§è®Šæ›´**

- 357/357 æ¸¬è©¦é€šé
- TypeScript é›¶éŒ¯èª¤
- å‘å¾Œç›¸å®¹ï¼ˆåƒ…å¢å¼· UXï¼‰

---

## åƒè€ƒè³‡æ–™

1. **Web Research 2025-11-19**
   - iOS Calculator backspace: 0.5s initial, 0.1s interval
   - Button animation: 100ms duration, spring effect
   - iOS Numbers: åƒä½åˆ†éš”ç¬¦é¸é …ï¼ˆæå‡å¯è®€æ€§ï¼‰

2. **Apple HIG (Human Interface Guidelines)**
   - Button feedback: Clear and immediate
   - Animation duration: 100-300ms optimal range
   - Haptic feedback: Light for repeated actions

3. **å…§éƒ¨åƒè€ƒ**
   - `formatCalculatorNumber`: å·²æœ‰åƒä½åˆ†éš”ç¬¦å·¥å…·
   - `useLongPress`: é•·æŒ‰é‚è¼¯ Hook
   - `CalculatorKey`: æŒ‰éˆ•çµ„ä»¶

---

## CRITICAL BUG ä¿®å¾©ï¼ˆv1.1.0ï¼‰

### ğŸ› ç”¨æˆ¶å›å ±åš´é‡å•é¡Œï¼ˆ2025-11-19T23:36:54+08:00ï¼‰

**å•é¡Œ 1ï¼šBackspace é›™é‡è§¸ç™¼ï¼ˆé»ä¸€ä¸‹åˆªå…©å€‹æ•¸å­—ï¼‰**

**æ ¹å› **ï¼š

- `useLongPress` çš„ `onClick` å‘¼å« `handleClick()`
- `handleClick()` å…§éƒ¨åˆå‘¼å« `onClick(value)`
- çµæœï¼š**é›™é‡è§¸ç™¼åˆªé™¤**

**ä¿®å¾©æ–¹æ¡ˆ**ï¼ˆapps/ratewise/src/features/calculator/components/CalculatorKey.tsxï¼‰ï¼š

```typescript
// âŒ ä¿®å¾©å‰ï¼ˆLine 97-103ï¼‰
onClick: value === 'backspace'
  ? () => {
      if (disabled) return;
      handleClick(); // â† BUGï¼šå°è‡´é›™é‡è§¸ç™¼
    }
  : undefined,

// âœ… ä¿®å¾©å¾Œ
onClick: value === 'backspace'
  ? () => {
      if (disabled) return;
      lightHaptic(); // å–®æ“Šè§¸è¦ºå›é¥‹
      onClick(value); // ç›´æ¥å‘¼å«ï¼Œé¿å…é›™é‡è§¸ç™¼
    }
  : undefined,
```

---

**å•é¡Œ 2ï¼šæŒ‰éˆ•æ”¾å¤§æ•ˆæœæœªé¡¯ç¾**

**æ ¹å› **ï¼š

- CSS `transition-all duration-200` è¦†è“‹ Motion å‹•ç•«
- `whileTap={{ scale: 1.1 }}` è¢« CSS è¦†è“‹å¤±æ•ˆ

**ä¿®å¾©æ–¹æ¡ˆ**ï¼ˆapps/ratewise/src/features/calculator/components/CalculatorKey.tsxï¼‰ï¼š

```typescript
// âŒ ä¿®å¾©å‰ï¼ˆLine 36ï¼‰
const baseStyles =
  'calculator-key relative h-16 rounded-xl font-semibold transition-all duration-200 select-none overflow-hidden';

// âœ… ä¿®å¾©å¾Œï¼ˆç§»é™¤ transition-allï¼‰
const baseStyles =
  'calculator-key relative h-16 rounded-xl font-semibold select-none overflow-hidden';
```

---

### é©—è­‰çµæœ

- âœ… TypeScript æª¢æŸ¥ï¼šé›¶éŒ¯èª¤
- âœ… æ¸¬è©¦å¥—ä»¶ï¼š357/357 é€šé
- âœ… ä¿®å¾©ç¢ºèªï¼šBackspace å–®æ“Šåªåˆªä¸€å€‹å­—å…ƒï¼ŒæŒ‰éˆ•æ”¾å¤§å‹•ç•«æ­£å¸¸é¡¯ç¤º

---

## ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬  | æ—¥æœŸ       | è®Šæ›´å…§å®¹                                                     |
| ----- | ---------- | ------------------------------------------------------------ |
| 1.0.0 | 2025-11-19 | åˆç‰ˆï¼šåƒä½åˆ†éš”ç¬¦ã€æŒ‰éˆ•å‹•ç•«ã€é•·æŒ‰å„ªåŒ–                         |
| 1.1.0 | 2025-11-19 | **CRITICAL FIX**ï¼šä¿®å¾© Backspace é›™é‡è§¸ç™¼ + æŒ‰éˆ•å‹•ç•«å¤±æ•ˆå•é¡Œ |

---

**æœ€å¾Œæ›´æ–°**: 2025-11-19T23:36:54+08:00  
**ç¶­è­·è€…**: Linus Guide Agent
