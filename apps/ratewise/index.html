<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

    <meta name="theme-color" content="#8B5CF6" />

    <!-- Cloudflare Rocket Loader 停用（與 CSP/Trusted Types 衝突） -->
    <meta name="cloudflare-rocket-loader" content="off" />

    <!-- 版本資訊（runtime 版本檢查用） -->
    <meta name="app-version" content="__APP_VERSION__" />
    <meta name="build-time" content="__BUILD_TIME__" />

    <!-- Google Search Console -->
    <meta name="google-site-verification" content="NBCorB6Jq_872WFLMgbSieWf_Wvt0EGse1QWXnM4AOo" />

    <!-- SEO Meta Tags 由 SEOHelmet 組件統一管理（所有頁面，包含首頁） -->

    <!-- PWA -->
    <link rel="icon" href="/ratewise/favicon.ico?v=20251208" sizes="48x48" />
    <link rel="icon" href="/ratewise/favicon.svg?v=20251208" sizes="any" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/ratewise/apple-touch-icon.png?v=20251208" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- iOS PWA Status Bar Configuration
         black-translucent: Allows content to extend behind status bar area
         Requires: viewport-fit=cover + env(safe-area-inset-*) for proper safe area handling
         @see https://webkit.org/blog/7929/designing-websites-for-iphone-x/ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="RateWise" />

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="dns-prefetch" href="https://raw.githubusercontent.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin />

    <!-- Theme Initialization (防止 FOUC) -->
    <script>
      (function () {
        var STORAGE_KEY = 'ratewise-theme';
        var DEFAULT_STYLE = 'zen';
        // Security: Whitelist of allowed theme styles to prevent injection
        var ALLOWED_STYLES = ['zen', 'nitro', 'kawaii', 'classic', 'ocean', 'forest'];

        /**
         * Validates theme config structure and style value
         * @param {unknown} config - Parsed config from localStorage
         * @returns {string} - Validated style or DEFAULT_STYLE
         */
        function getValidatedStyle(config) {
          // Security: Validate config is a plain object (not null, array, or prototype-polluted)
          if (
            config === null ||
            typeof config !== 'object' ||
            Array.isArray(config) ||
            config.constructor !== Object
          ) {
            return DEFAULT_STYLE;
          }

          // Security: Validate style property exists and is a string
          if (!Object.prototype.hasOwnProperty.call(config, 'style')) {
            return DEFAULT_STYLE;
          }

          var style = config.style;
          if (typeof style !== 'string') {
            return DEFAULT_STYLE;
          }

          // Security: Whitelist validation - only allow predefined styles
          return ALLOWED_STYLES.indexOf(style) !== -1 ? style : DEFAULT_STYLE;
        }

        function applyStyle(style) {
          document.documentElement.dataset.style = style;
          document.documentElement.classList.add(style === 'classic' ? 'font-serif' : 'font-sans');
        }

        try {
          var stored = localStorage.getItem(STORAGE_KEY);
          if (stored) {
            var config = JSON.parse(stored);
            var style = getValidatedStyle(config);
            applyStyle(style);
          } else {
            applyStyle(DEFAULT_STYLE);
          }
        } catch (e) {
          // Fallback for JSON parse errors or localStorage access errors
          applyStyle(DEFAULT_STYLE);
        }
      })();
    </script>

    <!-- Critical CSS (iOS PWA Optimized + Modern Skeleton) -->
    <style>
      /**
       * iOS PWA Standalone Mode - Safe Area Handling
       * @see https://web.dev/viewport-units/
       * @see https://webkit.org/blog/7929/designing-websites-for-iphone-x/
       */
      html {
        height: 100%;
        min-height: calc(100% + env(safe-area-inset-top, 0px));
      }
      body {
        margin: 0;
        padding: 0;
        min-height: 100%;
        min-height: 100dvh;
        background: #f8fafc;
        font-family:
          'Noto Sans TC',
          system-ui,
          -apple-system,
          sans-serif;
        -webkit-text-size-adjust: 100%;
      }
      /* Theme-aware skeleton variables
       * Maps to user's selected theme for seamless loading experience
       * @see index.css - theme color definitions
       */
      :root,
      [data-style='zen'] {
        --sk-bg: #f8fafc;
        --sk-surface: #ffffff;
        --sk-border: #e2e8f0;
        --sk-shimmer: #cbd5e1;
        --sk-accent: rgba(139, 92, 246, 0.15);
        --sk-accent-shimmer: rgba(139, 92, 246, 0.25);
      }
      [data-style='nitro'] {
        --sk-bg: #020617;
        --sk-surface: #0f172a;
        --sk-border: #1e293b;
        --sk-shimmer: #334155;
        --sk-accent: rgba(14, 165, 233, 0.2);
        --sk-accent-shimmer: rgba(14, 165, 233, 0.35);
      }
      [data-style='kawaii'] {
        --sk-bg: #fffaf4;
        --sk-surface: #ffffff;
        --sk-border: #fce7f3;
        --sk-shimmer: #fbcfe8;
        --sk-accent: rgba(244, 114, 182, 0.15);
        --sk-accent-shimmer: rgba(244, 114, 182, 0.25);
      }
      [data-style='classic'] {
        --sk-bg: #fffafb;
        --sk-surface: #ffffff;
        --sk-border: #e7e5e4;
        --sk-shimmer: #d6d3d1;
        --sk-accent: rgba(180, 83, 9, 0.12);
        --sk-accent-shimmer: rgba(180, 83, 9, 0.2);
      }
      [data-style='ocean'] {
        --sk-bg: #f0f9ff;
        --sk-surface: #ffffff;
        --sk-border: #bae6fd;
        --sk-shimmer: #7dd3fc;
        --sk-accent: rgba(6, 182, 212, 0.15);
        --sk-accent-shimmer: rgba(6, 182, 212, 0.25);
      }
      [data-style='forest'] {
        --sk-bg: #f0fdf4;
        --sk-surface: #ffffff;
        --sk-border: #bbf7d0;
        --sk-shimmer: #86efac;
        --sk-accent: rgba(22, 163, 74, 0.15);
        --sk-accent-shimmer: rgba(22, 163, 74, 0.25);
      }
      /* Skeleton page container */
      .skeleton-page {
        background: var(--sk-bg);
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
      }
      .skeleton-main {
        flex: 1;
        overflow: hidden;
        padding: 1rem;
      }
      .skeleton-main > .inner {
        max-width: 28rem;
        margin: 0 auto;
      }
      .skeleton-header {
        height: calc(3rem + env(safe-area-inset-top, 0px));
        padding: env(safe-area-inset-top, 0px) 1rem 0;
        display: flex;
        align-items: center;
        border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        background: var(--sk-surface);
        backdrop-filter: saturate(180%) blur(20px);
        -webkit-backdrop-filter: saturate(180%) blur(20px);
      }
      .skeleton-header-inner {
        width: 100%;
        max-width: 28rem;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 0.625rem;
      }
      .skeleton-bottom-nav {
        height: 3.5rem;
        padding-bottom: env(safe-area-inset-bottom, 0px);
        border-top: 1px solid rgba(0, 0, 0, 0.03);
        background: var(--sk-surface);
        backdrop-filter: saturate(180%) blur(20px);
        -webkit-backdrop-filter: saturate(180%) blur(20px);
      }
      .skeleton-bottom-nav-inner {
        height: 3.5rem;
        max-width: 28rem;
        margin: 0 auto;
        padding: 0 1rem;
        display: flex;
      }
      .skeleton-nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
      }
      /* Shimmer animation */
      @keyframes skeleton-shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }
      .skeleton-shimmer {
        background: linear-gradient(
          90deg,
          var(--sk-border) 25%,
          var(--sk-shimmer) 50%,
          var(--sk-border) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-shimmer 1.5s ease-in-out infinite;
      }
      .skeleton-shimmer-accent {
        background: linear-gradient(
          90deg,
          var(--sk-accent) 25%,
          var(--sk-accent-shimmer) 50%,
          var(--sk-accent) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-shimmer 1.5s ease-in-out infinite;
      }
      /* Card style */
      .skeleton-card {
        background: var(--sk-surface);
        border-radius: 1.5rem;
        border: 1px solid var(--sk-border);
        padding: 1rem;
      }
      /* Trend area */
      .skeleton-bg {
        background: linear-gradient(to bottom right, var(--sk-accent), transparent);
        border-radius: 0.75rem;
      }
      /* Utilities */
      .sk-space-y-4 > * + * {
        margin-top: 1rem;
      }
      .sk-space-y-3 > * + * {
        margin-top: 0.75rem;
      }
      .sk-space-y-2 > * + * {
        margin-top: 0.5rem;
      }
      .sk-flex {
        display: flex;
      }
      .sk-gap-2 {
        gap: 0.5rem;
      }
      .sk-justify-center {
        justify-content: center;
      }
      .sk-text-center {
        text-align: center;
      }
      .sk-mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .sk-py-3 {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
      }
      .sk-rounded {
        border-radius: 0.25rem;
      }
      .sk-rounded-xl {
        border-radius: 0.75rem;
      }
      .sk-rounded-2xl {
        border-radius: 1rem;
      }
      .sk-rounded-full {
        border-radius: 9999px;
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>

    <noscript>
      <link rel="stylesheet" href="./loading.css" />
    </noscript>

    <!-- Structured Data managed by SEOHelmet component (prevents duplicate schemas) -->
    <!-- Title managed by SEOHelmet component (prevents duplicate titles) -->
  </head>
  <body class="bg-slate-50">
    <noscript>
      <div class="noscript-container">
        <h1 class="noscript-title">RateWise 匯率好工具 - 即時匯率轉換器</h1>
        <p class="noscript-description">
          RateWise 提供即時匯率換算服務,參考臺灣銀行牌告匯率，支援 TWD、USD、JPY、EUR、GBP 等 30+
          種貨幣。 快速、準確、離線可用的 PWA 匯率工具。
        </p>
        <h2 class="noscript-subtitle">主要功能</h2>
        <ul class="noscript-list">
          <li>即時匯率查詢 - 參考臺灣銀行牌告匯率</li>
          <li>單幣別換算 - 快速換算兩種貨幣</li>
          <li>多幣別同時換算 - 一次比較多種貨幣</li>
          <li>歷史匯率趨勢 - 查看過去匯率變化</li>
          <li>離線使用 - PWA 支援離線存取</li>
          <li>支援 30+ 種主要貨幣</li>
        </ul>
        <p class="noscript-footer">
          ⚠️ 本服務需要瀏覽器啟用 JavaScript 才能顯示即時匯率換算結果。若無法啟用，請改用
          <a
            href="https://rate.bot.com.tw/xrt?Lang=zh-TW"
            rel="noopener noreferrer"
            class="noscript-link"
          >
            臺灣銀行牌告匯率
          </a>
          查詢最新資料。
        </p>
      </div>
    </noscript>
    <div id="root">
      <!-- Modern Skeleton matching SkeletonLoader.tsx -->
      <div class="skeleton-page" role="status" aria-live="polite">
        <header class="skeleton-header">
          <div class="skeleton-header-inner">
            <div class="skeleton-shimmer sk-rounded" style="height: 1.75rem; width: 1.75rem"></div>
            <div class="skeleton-shimmer sk-rounded" style="height: 1rem; width: 9rem"></div>
          </div>
        </header>

        <main class="skeleton-main">
          <div class="inner sk-space-y-4">
            <!-- 來源貨幣輸入骨架 -->
            <div class="sk-space-y-3">
              <div class="skeleton-shimmer sk-rounded" style="height: 1rem; width: 5rem"></div>
              <div
                class="skeleton-shimmer sk-rounded-2xl"
                style="height: 3.5rem; width: 100%"
              ></div>
              <!-- 快速金額按鈕 -->
              <div class="sk-flex sk-gap-2" style="overflow: hidden">
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
              </div>
            </div>

            <!-- 匯率卡片骨架 -->
            <div class="skeleton-card sk-space-y-3">
              <div class="sk-flex sk-justify-center">
                <div
                  class="skeleton-shimmer sk-rounded-full"
                  style="height: 1.75rem; width: 7rem"
                ></div>
              </div>
              <div class="sk-text-center sk-space-y-2 sk-py-3">
                <div
                  class="skeleton-shimmer sk-rounded-xl sk-mx-auto"
                  style="height: 1.75rem; width: 13rem"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded sk-mx-auto"
                  style="height: 1rem; width: 10rem"
                ></div>
              </div>
              <div class="skeleton-bg" style="height: 5rem"></div>
            </div>

            <!-- 交換按鈕骨架 -->
            <div class="sk-flex sk-justify-center">
              <div
                class="skeleton-shimmer-accent sk-rounded-full"
                style="width: 2.75rem; height: 2.75rem"
              ></div>
            </div>

            <!-- 目標貨幣輸入骨架 -->
            <div class="sk-space-y-3">
              <div class="skeleton-shimmer sk-rounded" style="height: 1rem; width: 5rem"></div>
              <div
                class="skeleton-shimmer-accent sk-rounded-2xl"
                style="height: 3.5rem; width: 100%"
              ></div>
              <!-- 快速金額按鈕 -->
              <div class="sk-flex sk-gap-2" style="overflow: hidden">
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
                <div
                  class="skeleton-shimmer sk-rounded-xl"
                  style="height: 2rem; width: 3.5rem; flex-shrink: 0"
                ></div>
              </div>
            </div>

            <!-- 加入歷史記錄按鈕骨架 -->
            <div class="skeleton-shimmer-accent sk-rounded-xl" style="height: 3rem"></div>

            <!-- 資料來源骨架 -->
            <div class="sk-flex sk-justify-center">
              <div class="skeleton-shimmer sk-rounded" style="height: 0.75rem; width: 10rem"></div>
            </div>
          </div>
          <span class="sr-only">載入匯率資料中...</span>
        </main>

        <nav class="skeleton-bottom-nav">
          <div class="skeleton-bottom-nav-inner">
            <div class="skeleton-nav-item">
              <div
                class="skeleton-shimmer sk-rounded"
                style="height: 1.25rem; width: 1.25rem"
              ></div>
              <div class="skeleton-shimmer sk-rounded" style="height: 0.5rem; width: 2rem"></div>
            </div>
            <div class="skeleton-nav-item">
              <div
                class="skeleton-shimmer sk-rounded"
                style="height: 1.25rem; width: 1.25rem"
              ></div>
              <div class="skeleton-shimmer sk-rounded" style="height: 0.5rem; width: 2rem"></div>
            </div>
            <div class="skeleton-nav-item">
              <div
                class="skeleton-shimmer sk-rounded"
                style="height: 1.25rem; width: 1.25rem"
              ></div>
              <div class="skeleton-shimmer sk-rounded" style="height: 0.5rem; width: 2rem"></div>
            </div>
            <div class="skeleton-nav-item">
              <div
                class="skeleton-shimmer sk-rounded"
                style="height: 1.25rem; width: 1.25rem"
              ></div>
              <div class="skeleton-shimmer sk-rounded" style="height: 0.5rem; width: 2rem"></div>
            </div>
          </div>
        </nav>
      </div>
    </div>
    <script type="module" data-cfasync="false" src="./src/main.tsx"></script>
  </body>
</html>
