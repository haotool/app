# æ¸¬è©¦è¦†è“‹ç‡æœ€ä½³å¯¦è¸

> åŸºæ–¼ Linus Torvalds é–‹ç™¼å“²å­¸èˆ‡ Vitest å®˜æ–¹å»ºè­°

**å»ºç«‹æ™‚é–“**: 2025-10-31
**ç¶­è­·è€…**: Claude Code
**ç‹€æ…‹**: âœ… å·²å®Œæˆ

---

## ğŸ“Š ç•¶å‰è¦†è“‹ç‡ç‹€æ…‹

| æŒ‡æ¨™           | ç•¶å‰å€¼ | æ¥­ç•Œæ¨™æº– | ç‹€æ…‹                |
| -------------- | ------ | -------- | ------------------- |
| **Statements** | 94.59% | 80%      | âœ… **è¶…è¶Š +14.59%** |
| **Branches**   | 83.6%  | 70%      | âœ… **è¶…è¶Š +13.6%**  |
| **Functions**  | 91.26% | 90%      | âœ… **è¶…è¶Š +1.26%**  |
| **Lines**      | 94.59% | 80%      | âœ… **è¶…è¶Š +14.59%** |

**ç¸½æ¸¬è©¦æ•¸**: 161 å€‹æ¸¬è©¦
**æ¸¬è©¦è¦†è“‹**: é—œéµæ¥­å‹™é‚è¼¯ 95%+

---

## ğŸ¯ æ ¸å¿ƒåŸå‰‡

### 1. Linus Torvalds çš„ "Good Taste" åŸå‰‡

**çŸ¥é“ä½•æ™‚åœæ­¢æ¯”çŸ¥é“ä½•æ™‚é–‹å§‹æ›´é‡è¦**

```typescript
// âœ… å¥½å“å‘³ï¼šæ¸¬è©¦é—œéµè¡Œç‚º
it('æ‡‰è©²åœ¨åŒ¯ç‡éæœŸæ™‚è‡ªå‹•åˆ·æ–°', async () => {
  // æ¸¬è©¦å¯¦éš›æ¥­å‹™é‚è¼¯
});

// âŒ éåº¦å·¥ç¨‹åŒ–ï¼šæ¸¬è©¦å¯¦ä½œç´°ç¯€
it('æ‡‰è©²èª¿ç”¨ useState 3 æ¬¡', () => {
  // æ¸¬è©¦æ¡†æ¶å…§éƒ¨è¡Œç‚ºï¼Œè„†å¼±ä¸”ç„¡æ„ç¾©
});
```

### 2. æ¥­ç•Œæ¨™æº–å°ç…§

åŸºæ–¼ Vitest å®˜æ–¹æ–‡æª”å’Œ Google Testing æ¨™æº–ï¼š

| ç¨‹å¼ç¢¼é¡å‹                     | å»ºè­°è¦†è“‹ç‡ | æˆ‘å€‘çš„å¯¦è¸ |
| ------------------------------ | ---------- | ---------- |
| **é—œéµæ¥­å‹™é‚è¼¯** (æ”¯ä»˜ã€èªè­‰)  | 90-95%     | âœ… 95.12%  |
| **æ¥­å‹™é‚è¼¯** (services, hooks) | 80-85%     | âœ… 94.06%  |
| **UI çµ„ä»¶**                    | 70-75%     | âœ… 90.5%   |
| **å·¥å…·å‡½æ•¸**                   | 85-90%     | âœ… 95.92%  |

---

## âš™ï¸ è¨­å®šèªªæ˜

### Coverage Thresholds è¨­å®š

```typescript
// vitest.config.ts
coverage: {
  thresholds: {
    // åŸºæ–¼ Linus Torvalds å“²å­¸è¨­ç½®å¯¦ç”¨ä¸”å¯ç¶­è­·çš„é–€æª»
    statements: 90,   // ç•¶å‰: 94.59% (ç•™ 4.59% ç·©è¡)
    branches: 80,     // ç•¶å‰: 83.6%  (ç•™ 3.6% ç·©è¡)
    functions: 88,    // ç•¶å‰: 91.26% (ç•™ 3.26% ç·©è¡)
    lines: 90,        // ç•¶å‰: 94.59% (ç•™ 4.59% ç·©è¡)
  }
}
```

**ç‚ºä½•ä¸è¨­å®š 95%+ï¼Ÿ**

1. é¿å…ç‚ºäº†æ•¸å­—è€Œå¢åŠ ä½åƒ¹å€¼æ¸¬è©¦
2. å…è¨±åˆç†çš„é‡æ§‹ç©ºé–“
3. é˜²æ­¢éåº¦å·¥ç¨‹åŒ–
4. éµå¾ª Linus "å¯¦ç”¨ä¸»ç¾©" åŸå‰‡

---

## ğŸš« ä¸æ‡‰è©²åšçš„äº‹

### 1. ä¸è¦ç‚ºäº† 100% è€Œæ¸¬è©¦ç¬¬ä¸‰æ–¹åº«

```typescript
// âŒ éŒ¯èª¤ï¼šæ¸¬è©¦ Recharts å…§éƒ¨é‚è¼¯
it('æ‡‰è©²æ­£ç¢ºæ¸²æŸ“ SVG path å…ƒç´ ', () => {
  const { container } = render(<TrendChart data={mockData} />);
  expect(container.querySelector('svg path')).toBeInTheDocument();
  // é€™æ˜¯æ¸¬è©¦ Rechartsï¼Œä¸æ˜¯æˆ‘å€‘çš„ç¨‹å¼ç¢¼
});

// âœ… æ­£ç¢ºï¼šæ¸¬è©¦æˆ‘å€‘çš„æ¥­å‹™é‚è¼¯
it('æ‡‰è©²æ­£ç¢ºè¨ˆç®—è¶¨å‹¢æ–¹å‘', () => {
  const trend = calculateTrend(mockData);
  expect(trend.direction).toBe('up');
  // æ¸¬è©¦æˆ‘å€‘çš„è¨ˆç®—é‚è¼¯
});
```

### 2. ä¸è¦æ¨¡æ“¬æ¥µç«¯ç½•è¦‹çš„éŒ¯èª¤å ´æ™¯

```typescript
// âŒ éåº¦å·¥ç¨‹åŒ–ï¼šæ¨¡æ“¬ JavaScript å¼•æ“å´©æ½°
it('æ‡‰è©²åœ¨ V8 heap æº¢å‡ºæ™‚å„ªé›…é™ç´š', () => {
  // é€™ç¨®å ´æ™¯å¹¾ä¹ä¸å¯èƒ½ç™¼ç”Ÿï¼Œä¸”ç„¡æ³•å¯é æ¸¬è©¦
});

// âœ… å¯¦ç”¨ä¸»ç¾©ï¼šæ¸¬è©¦åˆç†çš„éŒ¯èª¤æƒ…æ³
it('æ‡‰è©²åœ¨ç¶²è·¯éŒ¯èª¤æ™‚ä½¿ç”¨å¿«å–', async () => {
  mockFetch.mockRejectedValue(new Error('Network error'));
  const result = await getExchangeRates();
  expect(result).toEqual(cachedData);
});
```

### 3. ä¸è¦æ¸¬è©¦ç´”è¦–è¦ºæ•ˆæœ

```typescript
// âŒ ä½åƒ¹å€¼ï¼šæ¸¬è©¦ CSS å‹•ç•«
it('éª¨æ¶è¼‰å…¥å™¨æ‡‰è©²æœ‰æ·¡å…¥å‹•ç•«', () => {
  const { container } = render(<SkeletonLoader />);
  expect(container.firstChild).toHaveClass('animate-pulse');
  // CSS é¡åˆ¥å­˜åœ¨ä¸ä»£è¡¨å‹•ç•«æ­£ç¢º
});

// âœ… é«˜åƒ¹å€¼ï¼šæ¸¬è©¦å¯è¦‹æ€§é‚è¼¯
it('è¼‰å…¥æ™‚æ‡‰è©²é¡¯ç¤ºéª¨æ¶è¼‰å…¥å™¨', () => {
  const { getByRole } = render(<App loading={true} />);
  expect(getByRole('status')).toBeInTheDocument();
});
```

---

## âœ… æ‡‰è©²åšçš„äº‹

### 1. æ¸¬è©¦è¡Œç‚ºè€Œéå¯¦ä½œ

```typescript
// âœ… æ¸¬è©¦ä½¿ç”¨è€…å¯è¦‹çš„è¡Œç‚º
it('æ‡‰è©²åœ¨åŒ¯ç‡æ›´æ–°æ™‚é¡¯ç¤ºæ–°æ•¸å€¼', async () => {
  const { getByText } = render(<RateWise />);
  await waitFor(() => {
    expect(getByText('30.5')).toBeInTheDocument();
  });
});
```

### 2. é—œæ³¨é—œéµè·¯å¾‘

```typescript
// âœ… æ¸¬è©¦é—œéµæ¥­å‹™æµç¨‹
describe('åŒ¯ç‡è½‰æ›æ ¸å¿ƒæµç¨‹', () => {
  it('æ‡‰è©²æ­£ç¢ºè¨ˆç®—é›™å‘åŒ¯ç‡');
  it('æ‡‰è©²åœ¨åŒ¯ç‡éæœŸæ™‚è‡ªå‹•åˆ·æ–°');
  it('æ‡‰è©²åœ¨é›¢ç·šæ™‚ä½¿ç”¨å¿«å–');
  it('æ‡‰è©²æ­£ç¢ºè™•ç†è²¨å¹£äº¤æ›');
});
```

### 3. ä¿æŒæ¸¬è©¦ç°¡å–®æ˜“è®€

```typescript
// âœ… AAA æ¨¡å¼ï¼šArrange-Act-Assert
it('æ‡‰è©²æ­£ç¢ºæ¸…é™¤éæœŸå¿«å–', () => {
  // Arrange
  const staleData = createStaleCache(20); // 20 åˆ†é˜å‰
  localStorage.setItem('exchangeRates', JSON.stringify(staleData));

  // Act
  clearExpiredCache();

  // Assert
  expect(localStorage.getItem('exchangeRates')).toBeNull();
});
```

---

## ğŸ“ æœªè¦†è“‹ç¨‹å¼ç¢¼åˆ†æ

### ç‚ºä»€éº¼å‰©é¤˜ 5.41% ä¸éœ€è¦æ¸¬è©¦ï¼Ÿ

#### 1. ErrorBoundary éŒ¯èª¤æ¢å¾© (56-65 è¡Œ)

**åŸå› **: React éŒ¯èª¤é‚Šç•Œçš„æ¥µç«¯å ´æ™¯ï¼Œé›£ä»¥å¯é æ¨¡æ“¬
**é¢¨éšª**: ä½ - React è‡ªèº«å·²å……åˆ†æ¸¬è©¦
**æ›¿ä»£æ–¹æ¡ˆ**: ä¾è³´ E2E æ¸¬è©¦å’Œ Sentry ç›£æ§

#### 2. TrendChart åœ–è¡¨ç´°ç¯€ (150-178 è¡Œ)

**åŸå› **: Recharts åº«çš„å…§éƒ¨æ¸²æŸ“é‚è¼¯
**é¢¨éšª**: ä½ - è¦–è¦ºå•é¡Œæ˜“æ–¼ç™¼ç¾
**æ›¿ä»£æ–¹æ¡ˆ**: è¦–è¦ºå›æ­¸æ¸¬è©¦ (Playwright)

#### 3. VersionIndicator UI é‚è¼¯ (43,45,50,52 è¡Œ)

**åŸå› **: ç°¡å–®çš„æ¢ä»¶æ¸²æŸ“ï¼Œä½æ¥­å‹™é¢¨éšª
**é¢¨éšª**: æ¥µä½ - ä¸å½±éŸ¿æ ¸å¿ƒåŠŸèƒ½
**æ›¿ä»£æ–¹æ¡ˆ**: æ‰‹å‹•æ¸¬è©¦å³å¯

---

## ğŸ” è³ªé‡ç›£æ§

### 1. ä½¿ç”¨ Coverage Thresholds é˜²æ­¢é€€åŒ–

```bash
# æ¯æ¬¡ CI éƒ½æœƒæª¢æŸ¥
pnpm test:coverage

# å¦‚æœä½æ–¼é–€æª»æœƒå¤±æ•—
ERROR: Coverage for statements (89.5%) does not meet threshold (90%)
```

### 2. å®šæœŸ Review æ¸¬è©¦å“è³ª

**æ¯æœˆæª¢æŸ¥æ¸…å–®**ï¼š

- [ ] æœ‰æ²’æœ‰è„†å¼±çš„æ¸¬è©¦ï¼ˆç¶“å¸¸å› é‡æ§‹å¤±æ•—ï¼‰ï¼Ÿ
- [ ] æœ‰æ²’æœ‰æ¸¬è©¦å¯¦ä½œç´°ç¯€è€Œéè¡Œç‚ºï¼Ÿ
- [ ] æœ‰æ²’æœ‰éåº¦è¤‡é›œçš„ mockï¼Ÿ
- [ ] æ¸¬è©¦åŸ·è¡Œé€Ÿåº¦æ˜¯å¦åˆç†ï¼Ÿ

### 3. é—œæ³¨æ¸¬è©¦ç¶­è­·æˆæœ¬

```typescript
// âš ï¸ è­¦è¨Šï¼šæ¸¬è©¦æ¯”è¢«æ¸¬ç¨‹å¼ç¢¼é‚„è¤‡é›œ
// æ¸¬è©¦ç¨‹å¼ç¢¼: 150 è¡Œ
// è¢«æ¸¬ç¨‹å¼ç¢¼: 50 è¡Œ
// â†’ å¯èƒ½æ˜¯éåº¦å·¥ç¨‹åŒ–
```

---

## ğŸ“š åƒè€ƒè³‡æ–™

### å®˜æ–¹æ–‡æª”

- [Vitest Coverage Guide](https://vitest.dev/guide/coverage.html)
- [Vitest Coverage Config](https://vitest.dev/config/#coverage)
- [React Testing Library Best Practices](https://testing-library.com/docs/react-testing-library/intro/)

### æ¥­ç•Œæ¨™æº–

- **Google Testing Blog**: Critical code 90-95%, Business logic 80-85%
- **Martin Fowler Test Pyramid**: é‡é»æ˜¯æ¸¬è©¦é—œéµè·¯å¾‘ï¼Œè€Œéè¿½æ±‚æ•¸å­—
- **Vitest Watermarks**: [50, 80] è¡¨ç¤º 80% å·²æ˜¯é«˜è¦†è“‹ç‡

### Linus Torvalds å“²å­¸

- **Good Taste**: æ¶ˆé™¤ç‰¹æ®Šæƒ…æ³è€Œéå¢åŠ æ¢ä»¶åˆ¤æ–·
- **å¯¦ç”¨ä¸»ç¾©**: è§£æ±ºå¯¦éš›å•é¡Œè€Œéå‡æƒ³å¨è„…
- **ç°¡æ½”åŸ·å¿µ**: ç°¡å–®çš„è§£æ±ºæ–¹æ¡ˆæ°¸é å„ªæ–¼è¤‡é›œçš„

---

## ğŸ“ ç¸½çµ

### æ ¸å¿ƒä¿¡å¿µ

> "å®Œç¾æ˜¯å¥½çš„æ•µäºº" - Voltaire
> "éæ—©å„ªåŒ–æ˜¯è¬æƒ¡ä¹‹æº" - Donald Knuth
> "ç°¡å–®æ¯”è¤‡é›œå¥½" - Python Zen

### è¡Œå‹•æº–å‰‡

1. âœ… **æ¸¬è©¦è¡Œç‚ºï¼Œä¸æ¸¬è©¦å¯¦ä½œ**
2. âœ… **é—œæ³¨é—œéµè·¯å¾‘ï¼Œå¿½ç•¥é‚Šç·£æƒ…æ³**
3. âœ… **ä¿æŒæ¸¬è©¦ç°¡å–®æ˜“è®€**
4. âœ… **è¨­å®šåˆç†é–€æª»ï¼Œé˜²æ­¢é€€åŒ–**
5. âŒ **ä¸è¿½æ±‚ 100% è¦†è“‹ç‡**
6. âŒ **ä¸ç‚ºäº†æ•¸å­—è€Œæ¸¬è©¦**

### ç•¶å‰ç‹€æ…‹

**94.59%** è¦†è“‹ç‡ = **å„ªç§€ä¸”å¯ç¶­è­·**
ä¸éœ€è¦ç¹¼çºŒæå‡ âœ…

---

**æœ€å¾Œæ›´æ–°**: 2025-10-31
**ä¸‹æ¬¡ Review**: 2025-11-30
