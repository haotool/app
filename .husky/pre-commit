#!/bin/sh

# RateWise Pre-commit Hook
# [BDD:2025-12-01] æ•´åˆå®Œæ•´å“è³ªæª¢æŸ¥åˆ° Git workflow
# [CI:2025-12-01] é˜²æ­¢ CI å¤±æ•—çš„æ ¹æœ¬åŸå› 

echo "ğŸ” åŸ·è¡Œ Pre-commit æª¢æŸ¥..."

# 1. Lint-staged (ç¨‹å¼ç¢¼æ ¼å¼åŒ–èˆ‡ Lint)
echo "\nğŸ“‹ Step 1/3: Lint-staged..."
pnpm lint-staged
if [ $? -ne 0 ]; then
  echo "\nâŒ Lint-staged å¤±æ•—ï¼Œè«‹ä¿®å¾©å¾Œå†æäº¤"
  exit 1
fi

# 2. TypeScript æª¢æŸ¥ (å¿«é€Ÿé©—è­‰é¡å‹éŒ¯èª¤)
echo "\nğŸ“‹ Step 2/3: TypeScript æª¢æŸ¥..."
pnpm typecheck
if [ $? -ne 0 ]; then
  echo "\nâŒ TypeScript æª¢æŸ¥å¤±æ•—ï¼Œè«‹ä¿®å¾©é¡å‹éŒ¯èª¤å¾Œå†æäº¤"
  exit 1
fi

# 3. æ ¼å¼æª¢æŸ¥ (ç¢ºä¿æ‰€æœ‰æ–‡ä»¶å·²æ ¼å¼åŒ–)
echo "\nğŸ“‹ Step 3/3: Prettier æ ¼å¼æª¢æŸ¥..."
pnpm format
if [ $? -ne 0 ]; then
  echo "\nâŒ æ ¼å¼æª¢æŸ¥å¤±æ•—ï¼Œè«‹åŸ·è¡Œ 'pnpm format:fix' å¾Œå†æäº¤"
  exit 1
fi

echo "\nâœ… æ‰€æœ‰ Pre-commit æª¢æŸ¥é€šé"
